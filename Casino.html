<meta charset="utf-8">
<script>

//Упускаем возможность
function loseGodSend(){
	var message = "Вы решили, что лучшим решением будет оставить этот свёрток на месте. Вдруг он заговорённый?\n\nИ точно! Он оказался таким! Уже через полгода вас одолела страшная участь - во время бракоразводного процесса вас обобрали до нитки.\n\n\"По вере вашей да будет вам\" (Матф.9:29).";
	alert(message);
}

//Просто определим размер депозита. Используется только в варианте с банком
function deposit(rub, pct, term){
	for (var i = 0; i < term; i++){
		rub = rub * (1 + pct/100);
	}
	return Math.round(rub);
}
//Идём в банк
function fate(cash){
//Определяем процентную ставку
	var depo = Math.round(Math.random() * 7 + 7);
	var message = "Вы нашли очень выгодную долгосрочного депозита. " + depo + "% годовых.";
	alert(message);
//Судьба-злодейка. Определяем будущее
	var fateTime = Math.round(Math.random() * 5);
	if (fateTime == 5){
		alert("Через 5 лет вы благополучно закрыли депозит и забрали свои " + deposit(cash, depo, 5) + " руб.");
	} else if (fateTime == 4){
		alert("Через 4 года вы задолжали крупную сумму. Некоторую её часть вы покрыли своим депозитом, остальное вам предстоит отрабатывать долгие годы.");
	} else if (fateTime == 3){
		alert("3 года спустя вы выиграли в лотерею и укатили на Гаити. Про свой депозит вы так и не вспомнили.");
	} else if (fateTime == 2){
		alert("У вас часто задерживали зарплату и вы по-немногу снимали со своего депозита. Придя в очередной раз за заначкой, вы вдруг поняли, что горшочек иссяк");
	} else if (fateTime == 1){
		alert("Вы никогда не обращали внимания на репутацию банка. А зря. Вы на своём опыте познали горькую судьбу обманутых вкладчиков");
	} else {
		alert("Однажды вечером вы похвастались своей подруге своим счастьем. Завтра вечером вам вдруг позвонил один старый друг, потом второй... О вас вспомнили ваши старые друзья. Но не надолго.");
	}
}

//Идём в шоколадный притон
function crackhouse(){
	var sweet = "Вы отправились в жилой сектор в поисках дома со сладостями. Пройдясь по подъездам, вы унюхали столь желанный запах. Проследив ещё немного, вы без труда определили квартиру, по большому количество молодёжи. Они приходили туда как днём, так и ночью и выглядели так, словно съели шоколадку или даже ириску.\n\nЧерез двое суток вас увезли на карете в сказочный замок."
	alert(sweet);
}

//Идём в казино
function casino(){
	var welcome = "Охранник на входе приветствует каменным лицом. Пройдя в зал, вы решили обменять все свои кровные на фишки.\nПолучив на руки стопку фишек, вы решили немного поиграть."
	alert(welcome);
	game = true;
}

//Black Jack
//определяем номер карты для раздачи
function getRandomInt(min, max){
		return Math.floor(Math.random() * (max - min + 1)) + min;
	}
//тянем карту
function getCard(){
	var cards = ['2','3','4','5','6', '7', '8', '9', '10', 'J', 'Q', 'K', "A"];
	return cards[getRandomInt(0, cards.length - 1)];
}
//определяем сумму карт на руке
function getSum(hand){
	var sum = 0;
	for (var i = 0; i < hand.length; i++){
		if (hand[i] != 'A'){
			if (isNaN(hand[i])){
				sum += 10;
			} else
				sum += parseInt(hand[i]);
		}
	}
	for (var i = 0; i < hand.length; i++){
		if (hand[i] == "A"){
			if (sum > 10)
				sum += 1;
			else
				sum += 11;
		}
	}
	return sum;
}
//выводим текущий статус игры
function getStatus(dealer, player){
	return ("\nДилер: " + dealer.join(', ') + '\nИгрок: ' + player.join(', ') + '.');
}
//общий функционал игры
function blackJackGame(dealer, player, count, cash){
	var result;
	alert("игра # " + count);
	
	if (getSum(player) == 21){
		alert('Дьявольское везение! Black Jack на раздаче. $_$');
		result = "win";
	} else {
		var answer;
		do {
			answer = prompt(getStatus(dealer, player) + '\nХотите взять ещё 1 карту?\n1 - да, иначе - нет.');
		//сдаем карту, либо прекращаем игру
			if (answer == 1) {
				player.push(getCard());
				sum = getSum(player);
				if (sum == 21){
					alert("Black Jack! (:\n" + getStatus(dealer, player));
					result = "win";
					break;
				} else if (sum > 21){
					alert("Перебор T_T\n" + getStatus(dealer, player));
					result = "loose";
					break;
				}
			} else {
				while (getSum(dealer) < 17){
					dealer.push(getCard());
				}

				var sumDealer = getSum(dealer);
				var sumPlayer = getSum(player);

				if (sumDealer == 21){
					alert('У дилера Black Jack! T_T\n' + getStatus(dealer, player));
					result = "loose";
				} else if (sumDealer > 21){
					alert('У дилера перебор! ]:->\n' + getStatus(dealer, player));
					result = "win";
				} else if (sumDealer < sumPlayer){
					alert('Выигрыш! (:\n' + getStatus(dealer, player));
					result = "win";
				} else if (sumPlayer == sumDealer){
					alert('Ничья! О_о\n' + getStatus(dealer, player))
					result = "deadlock";
				} else {
					alert('Проигрыш. :(\n' + getStatus(dealer, player));
					result = "loose";
				}
			}
		} while(answer == '1');
	}
	return result;
}
//сама игра
function blackJack(cash){
	alert(" \tBlack Jack.\nВы уселись за стол и приготовились к сдаче карт.");
	var deadlocks = 0;
	var wins = 0;
	var looses = 0;
	var count = 0;

	while(true){
		var dealer = [getCard()];
		var player = [getCard(), getCard()];
		count++;
		var s = blackJackGame(dealer, player, count, cash);
		if (s == "win"){
			wins++;
			cash++;
		} else if (s == "loose"){
			looses++;
			cash--;
		} else {
			deadlocks++;
		}
		var end = prompt("У вас на руках " + cash + " руб. Хотите продолжить?\n1 - да, остальное - нет");
		if (end != 1){
			alert("Ваш результат:\nНичьи: " + deadlocks + "\nПобеды: " + wins + "\nПроигрыши: " + looses + "\nНаличка: " + cash + " руб.");
			break;
		}
	}
	return cash;
}

//начало игры
var cash = getRandomInt(50, 123);
alert("Утро 1 авг'16. Минск, Беларусь.\nГуляя по парку, вы находите свёрток, в котором лежит " + cash + " руб.\n\"Неплохая находка!\" - подумали вы.\n\"Что бы такого с ними сделать?\"");

var decision;
var godsend = "1 - Положить на место и отправиться восвояси;\n2 - Открыть в банке депозит на 5 лет (до очередной инаугурации);\n3 - Найти притон и наприниматься там всяких конфет да шоколадок;\n4 - Сходить в казино;";
var game;

//Окно выбора действий с находкой
while(true){
	decision = prompt("Нужно сделать выбор...\n" + godsend);
	if (decision == 1){
		loseGodSend();
		break;
	} else if (decision == 2){
		fate(cash);
		break;
	} else if (decision == 3){
		crackhouse();
		break;
	} else if (decision == 4){
		casino();
		break;
	}
}

//Идём в казино?
while(game){
	decision = prompt("Добро пожаловать в казино!\nВаша наличность - " + cash + " руб.\nКакая игра вас больше всего интересует?\n\n1 - Black Jack\n2 - Русская рулетка(смертельно опасно)\n3 - Европейская рулетка\n4 - Американтская рулетка\n0 - Покинуть заведение");
	if (decision == 0){
		break;
	} else if(decision == 1){
		cash = blackJack(cash);
	} else if(decision == 2){
		alert("сыграем с оружием");
	} else if(decision == 3){
		alert("сыграем в европейскую рулетку");
	} else if(decision == 3){
		alert("сыграем в американскую рулетку (0 и 00)");
	}
}

	
</script>